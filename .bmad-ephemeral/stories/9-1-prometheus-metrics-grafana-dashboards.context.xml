<story-context id="{bmad_folder}/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>9</epicId>
    <storyId>1</storyId>
    <title>Prometheus Metrics & Grafana Dashboards</title>
    <status>drafted</status>
    <generatedAt>2025-11-15</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>.bmad-ephemeral/stories/9-1-prometheus-metrics-grafana-dashboards.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>ops engineer</asA>
    <iWant>Prometheus scraping metrics and Grafana displaying dashboards</iWant>
    <soThat>I can see system health, latency, and resource usage</soThat>
    <tasks>Task 1: Enhance Prometheus configuration (AC: 9.1.1, 9.1.3)
- Subtask 1.1: Configure Prometheus scraping for all 6 core services at 15s intervals
- Subtask 1.2: Implement custom metrics exporters for business metrics
- Subtask 1.3: Add metrics middleware to track request latency and error rates
- Subtask 1.4: Verify metrics endpoint response time &lt;10ms (p95)

Task 2: Create Grafana dashboards (AC: 9.1.2, 9.1.4)
- Subtask 2.1: Set up Grafana authentication and access control
- Subtask 2.2: Create System Overview dashboard (CPU, memory, disk usage)
- Subtask 2.3: Create Application Performance dashboard (latency, error rates, throughput)
- Subtask 2.4: Create LLM Metrics dashboard (call duration, success rates, model performance)
- Subtask 2.5: Create RAG Performance dashboard (retrieval latency, vector search metrics)
- Subtask 2.6: Create Infrastructure Health dashboard (service status, container health)
- Subtask 2.7: Configure dashboard refresh to 10 seconds

Task 3: Integration testing and validation (AC: All)
- Subtask 3.1: Test Prometheus scraping from all services
- Subtask 3.2: Verify Grafana dashboard accessibility and authentication
- Subtask 3.3: Validate dashboard data accuracy and refresh rates
- Subtask 3.4: Performance testing of metrics collection overhead</tasks>
  </story>

  <acceptanceCriteria>AC9.1.1: Prometheus successfully scrapes metrics from all 6 core services (Suna, Onyx, Qdrant, Supabase, Redis, LiteLLM) at 15-second intervals
AC9.1.2: Grafana displays 5 operational dashboards (System Overview, Application Performance, LLM Metrics, RAG Performance, Infrastructure Health) updating every 10 seconds
AC9.1.3: Metrics endpoint response time &lt;10ms (p95) across all services
AC9.1.4: Grafana dashboards accessible at http://localhost:3001 with authentication</acceptanceCriteria>

  <artifacts>
    <docs></docs>
    <code></code>
    <dependencies></dependencies>
  </artifacts>

  <constraints></constraints>
  <interfaces></interfaces>
  <tests>
    <standards></standards>
    <locations></locations>
    <ideas></ideas>
  </tests>
</story-context>