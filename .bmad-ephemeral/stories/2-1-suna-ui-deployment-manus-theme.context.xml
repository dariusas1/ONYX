<?xml version="1.0" encoding="UTF-8"?>
<story-context>
  <metadata>
    <story-id>2-1-suna-ui-deployment-manus-theme</story-id>
    <story-title>Suna UI Deployment with Manus Theme</story-title>
    <status>ready-for-dev</status>
    <epic>Epic 2: Chat Interface &amp; Core Intelligence</epic>
    <developer-model>Claude-3.5-Sonnet (2024-10-22)</developer-model>
    <context-generated>2025-11-13T00:00:00Z</context-generated>
    <priority>High (Blocker for Epic 2)</priority>
    <estimated-effort>2-3 days</estimated-effort>
  </metadata>

  <acceptance-criteria>
    <ac id="AC1">
      <title>Application Launch &amp; Performance</title>
      <given>Suna is running on :3000</given>
      <when>User navigates to http://localhost:3000</when>
      <then>
        <requirement>Chat interface loads in &lt;2s</requirement>
        <requirement>No console errors or warnings</requirement>
        <requirement>All assets (fonts, styles) load successfully</requirement>
      </then>
    </ac>
    <ac id="AC2">
      <title>Manus Dark Theme Application</title>
      <given>User has loaded the chat interface</given>
      <then>
        <requirement>Dark theme with blue accents (Manus color palette) is applied consistently</requirement>
        <requirement>Background color is #0F172A (Deep navy)</requirement>
        <requirement>Surface color is #1E293B (Elevated surface)</requirement>
        <requirement>Primary accent is #2563EB (Blue)</requirement>
        <requirement>Text color is #E2E8F0 (Light gray)</requirement>
      </then>
    </ac>
    <ac id="AC3">
      <title>Typography</title>
      <given>User views the interface</given>
      <then>
        <requirement>Inter font family is loaded and applied to all text elements</requirement>
        <requirement>Font weights are properly configured (400, 500, 600, 700)</requirement>
        <requirement>Text rendering is crisp and readable</requirement>
      </then>
    </ac>
    <ac id="AC4">
      <title>Layout &amp; Design</title>
      <given>User interacts with the chat interface</given>
      <then>
        <requirement>Layout is single-column, minimalist (focus on conversation)</requirement>
        <requirement>Maximum content width is 900px, centered on desktop</requirement>
        <requirement>Proper spacing and padding throughout</requirement>
        <requirement>No visual glitches or layout shifts</requirement>
      </then>
    </ac>
    <ac id="AC5">
      <title>Mobile Responsiveness</title>
      <given>User accesses the interface on various devices</given>
      <then>
        <requirement>Interface is responsive on desktop (&gt;1024px)</requirement>
        <requirement>Interface is responsive on tablet (768px-1024px)</requirement>
        <requirement>Interface is responsive on mobile (&lt;768px)</requirement>
        <requirement>Touch targets are appropriately sized (minimum 44x44px)</requirement>
        <requirement>No horizontal scrolling required</requirement>
      </then>
    </ac>
    <ac id="AC6">
      <title>Accessibility</title>
      <given>User navigates the interface</given>
      <then>
        <requirement>WCAG AA contrast ratios are met (4.5:1 minimum for normal text)</requirement>
        <requirement>Keyboard navigation works for all interactive elements</requirement>
        <requirement>Focus indicators are visible on all focusable elements</requirement>
        <requirement>Lighthouse accessibility score is &gt;90</requirement>
      </then>
    </ac>
    <ac id="AC7">
      <title>Browser Compatibility</title>
      <given>User accesses the interface from different browsers</given>
      <then>
        <requirement>Interface works correctly on Chrome (latest 2 versions)</requirement>
        <requirement>Interface works correctly on Safari (latest 2 versions)</requirement>
        <requirement>Interface works correctly on Firefox (latest 2 versions)</requirement>
      </then>
    </ac>
  </acceptance-criteria>

  <architecture-overview>
    <technology-stack>
      <frontend>
        <framework>Next.js 14 (App Router, Server Components)</framework>
        <runtime>React 18</runtime>
        <styling>Tailwind CSS 3.4+ with custom Manus theme</styling>
        <language>TypeScript (strict mode)</language>
        <package-manager>npm</package-manager>
      </frontend>
      <deployment>
        <target>Docker container on Hostinger KVM 4 VPS</target>
        <port>3000</port>
        <reverse-proxy>Nginx (configured in Epic 1)</reverse-proxy>
      </deployment>
    </technology-stack>

    <manus-theme-specification>
      <colors>
        <color name="bg" value="#0F172A" description="Deep navy background"/>
        <color name="surface" value="#1E293B" description="Elevated surface"/>
        <color name="accent" value="#2563EB" description="Primary blue"/>
        <color name="text" value="#E2E8F0" description="Light gray text"/>
        <color name="muted" value="#64748B" description="Muted text"/>
        <color name="border" value="#334155" description="Border color"/>
      </colors>
      <typography>
        <font-family>Inter, system-ui, sans-serif</font-family>
        <font-weights>400, 500, 600, 700</font-weights>
        <font-source>Google Fonts with Next.js Font Optimization</font-source>
      </typography>
      <layout>
        <desktop-max-width>900px</desktop-max-width>
        <breakpoints>
          <desktop>&gt;1024px</desktop>
          <tablet>768px-1024px</tablet>
          <mobile>&lt;768px</mobile>
        </breakpoints>
      </layout>
    </manus-theme-specification>

    <key-components>
      <component name="page.tsx" path="src/app/page.tsx">
        <description>Main chat page component</description>
        <responsibilities>
          <responsibility>Render full-screen chat interface</responsibility>
          <responsibility>Handle conversation ID routing</responsibility>
          <responsibility>Apply Manus background theme</responsibility>
        </responsibilities>
      </component>
      <component name="layout.tsx" path="src/app/layout.tsx">
        <description>Root layout with Manus theme and font loading</description>
        <responsibilities>
          <responsibility>Load Inter font from Google Fonts</responsibility>
          <responsibility>Apply global Manus theme</responsibility>
          <responsibility>Configure metadata and SEO</responsibility>
        </responsibilities>
      </component>
      <component name="ChatInterface.tsx" path="src/components/ChatInterface.tsx">
        <description>Core chat component</description>
        <responsibilities>
          <responsibility>Manage message state</responsibility>
          <responsibility>Handle user input</responsibility>
          <responsibility>Coordinate message list and input box (implementation in Story 2.4)</responsibility>
        </responsibilities>
      </component>
      <component name="Header.tsx" path="src/components/Header.tsx">
        <description>Header/navigation component</description>
        <responsibilities>
          <responsibility>Display logo/branding</responsibility>
          <responsibility>User menu placeholder</responsibility>
          <responsibility>Navigation elements (if needed)</responsibility>
        </responsibilities>
      </component>
      <component name="MessageList.tsx" path="src/components/MessageList.tsx">
        <description>Message display component</description>
        <responsibilities>
          <responsibility>Display conversation history</responsibility>
          <responsibility>Auto-scroll to latest message</responsibility>
          <responsibility>Virtual scrolling for performance (react-window)</responsibility>
        </responsibilities>
      </component>
      <component name="InputBox.tsx" path="src/components/InputBox.tsx">
        <description>Input component</description>
        <responsibilities>
          <responsibility>Text input with auto-resize</responsibility>
          <responsibility>Send button</responsibility>
          <responsibility>Keyboard shortcuts (Enter to send, Shift+Enter for new line)</responsibility>
        </responsibilities>
      </component>
    </key-components>
  </architecture-overview>

  <current-state-analysis>
    <existing-structure>
      <directory path="suna/" status="partial">
        <description>Next.js project initialized with basic configuration</description>
        <existing-files>
          <file path="package.json" status="complete">
            <description>Dependencies configured: Next.js 14, React 18, TypeScript, Tailwind CSS</description>
            <missing-dependencies>
              <dependency>@tailwindcss/typography - For markdown rendering</dependency>
              <dependency>react-window - For virtual scrolling</dependency>
              <dependency>react-markdown - For message rendering</dependency>
              <dependency>next-themes - For theme management (if needed)</dependency>
            </missing-dependencies>
          </file>
          <file path="next.config.js" status="exists">
            <description>Next.js configuration file</description>
            <needs-update>Configure for production build optimizations</needs-update>
          </file>
          <file path="src/app/api/health/health.js" status="exists">
            <description>Basic health check endpoint</description>
          </file>
        </existing-files>
        <missing-structure>
          <missing path="src/app/layout.tsx">Root layout with Inter font and Manus theme</missing>
          <missing path="src/app/page.tsx">Main chat page</missing>
          <missing path="src/components/*">All UI components (ChatInterface, Header, MessageList, InputBox)</missing>
          <missing path="src/styles/globals.css">Global styles with Manus theme variables</missing>
          <missing path="tailwind.config.js">Tailwind configuration with Manus colors</missing>
          <missing path="tsconfig.json">TypeScript configuration (strict mode)</missing>
        </missing-structure>
      </directory>
      <directory path="docker/" status="partial">
        <file path="Dockerfile.suna" status="missing">
          <description>Docker image for Suna production build</description>
          <requirement>Multi-stage build for optimized image size</requirement>
        </file>
      </directory>
      <file path="docker-compose.yaml" status="needs-update">
        <description>Main orchestration file</description>
        <current-suna-config>Basic service definition exists</current-suna-config>
        <needs-update>
          <update>Add port mapping 3000:3000</update>
          <update>Configure environment variables (NEXT_PUBLIC_API_BASE)</update>
          <update>Add dependencies on postgres and redis</update>
          <update>Configure build context and Dockerfile path</update>
        </needs-update>
      </file>
    </existing-structure>

    <gaps-identified>
      <gap priority="critical">No Next.js App Router structure (layout.tsx, page.tsx)</gap>
      <gap priority="critical">No Tailwind configuration with Manus theme</gap>
      <gap priority="critical">No UI components implemented</gap>
      <gap priority="high">Missing TypeScript configuration (tsconfig.json)</gap>
      <gap priority="high">No global styles (globals.css)</gap>
      <gap priority="high">No Docker build configuration (Dockerfile.suna)</gap>
      <gap priority="medium">Missing additional dependencies (@tailwindcss/typography, react-window, react-markdown)</gap>
      <gap priority="medium">No test setup for components</gap>
      <gap priority="low">No ESLint/Prettier configuration for Tailwind</gap>
    </gaps-identified>
  </current-state-analysis>

  <prd-requirements>
    <from-prd section="F1: Chat Interface &amp; Conversation Management">
      <requirement id="F1.1">Single-page chat UI with no page navigation, minimal chrome, focus on conversation</requirement>
      <requirement id="F1.2">Message history with last 100 messages per session, infinite scroll</requirement>
      <requirement id="F1.8">Keyboard shortcuts: Cmd+K for search, Cmd+N for new chat, Cmd+Enter to send</requirement>
    </from-prd>
    <from-prd section="A1: Accessibility &amp; UX">
      <requirement id="A1.1">Responsive design working on desktop, tablet, mobile (&gt;80% features)</requirement>
      <requirement id="A1.2">Dark mode with Manus dark theme (no light mode toggle initially)</requirement>
      <requirement id="A1.3">Keyboard navigation - tab through all interactive elements, Escape to close</requirement>
      <requirement id="A1.4">WCAG AA contrast ratios (4.5:1 for text)</requirement>
    </from-prd>
    <from-prd section="P1: Performance Requirements">
      <requirement id="P1.8">Page load in &lt;2s on 4G connection</requirement>
      <requirement id="P1.4">UI responsiveness &lt;100ms for all interactions</requirement>
    </from-prd>
  </prd-requirements>

  <technical-specifications>
    <tailwind-configuration>
      <config-file>tailwind.config.js</config-file>
      <theme-extension>
        <colors>
          <manus-palette>
            bg: '#0F172A',
            surface: '#1E293B',
            accent: '#2563EB',
            text: '#E2E8F0',
            muted: '#64748B',
            border: '#334155'
          </manus-palette>
        </colors>
        <font-family>
          sans: ['Inter', 'system-ui', 'sans-serif']
        </font-family>
      </theme-extension>
      <plugins>
        <plugin>@tailwindcss/typography - For prose styles</plugin>
      </plugins>
    </tailwind-configuration>

    <next-font-optimization>
      <import>import { Inter } from 'next/font/google'</import>
      <config>
        subsets: ['latin'],
        weight: ['400', '500', '600', '700'],
        display: 'swap'
      </config>
      <usage>Apply to body element via className</usage>
    </next-font-optimization>

    <typescript-configuration>
      <strict-mode>true</strict-mode>
      <compiler-options>
        <target>ES2020</target>
        <lib>ES2020, DOM, DOM.Iterable</lib>
        <jsx>preserve</jsx>
        <module>ESNext</module>
        <moduleResolution>bundler</moduleResolution>
        <paths>@/*: ["./src/*"]</paths>
        <strict>true</strict>
        <noUnusedLocals>true</noUnusedLocals>
        <noUnusedParameters>true</noUnusedParameters>
        <noImplicitReturns>true</noImplicitReturns>
      </compiler-options>
    </typescript-configuration>

    <responsive-design-breakpoints>
      <desktop>
        <min-width>1024px</min-width>
        <layout>Full-width single column, max 900px centered</layout>
        <spacing>Standard padding and margins</spacing>
      </desktop>
      <tablet>
        <range>768px-1024px</range>
        <layout>Full-width with adjusted padding</layout>
        <spacing>Reduced padding for medium screens</spacing>
      </tablet>
      <mobile>
        <max-width>768px</max-width>
        <layout>Full viewport, optimized touch targets</layout>
        <touch-targets>Minimum 44x44px for all interactive elements</touch-targets>
      </mobile>
    </responsive-design-breakpoints>

    <accessibility-requirements>
      <contrast-ratios>
        <normal-text>4.5:1 minimum (WCAG AA)</normal-text>
        <large-text>3:1 minimum (24px+)</large-text>
        <verification>All Manus color combinations must meet WCAG AA</verification>
      </contrast-ratios>
      <keyboard-navigation>
        <tab-order>Tab through all interactive elements</tab-order>
        <activation>Enter/Space to activate buttons</activation>
        <escape>Escape to close modals/dropdowns</escape>
        <arrows>Arrow keys for navigation where appropriate</arrows>
      </keyboard-navigation>
      <semantic-html>
        <structure>main, nav, article, section tags</structure>
        <aria-labels>ARIA labels for icon buttons</aria-labels>
        <heading-hierarchy>Proper h1, h2, h3 structure</heading-hierarchy>
      </semantic-html>
      <focus-indicators>
        <visibility>Visible focus ring on all focusable elements</visibility>
        <styling>Custom styling to match Manus theme</styling>
      </focus-indicators>
    </accessibility-requirements>

    <docker-configuration>
      <dockerfile>docker/Dockerfile.suna</dockerfile>
      <multi-stage-build>
        <stage-1-dependencies>Install dependencies (npm ci)</stage-1-dependencies>
        <stage-2-build>Build Next.js app (npm run build)</stage-2-build>
        <stage-3-production>Run production server (npm start)</stage-3-production>
      </multi-stage-build>
      <optimizations>
        <node-modules>Only production dependencies in final image</node-modules>
        <static-assets>Optimized with Next.js automatic optimization</static-assets>
        <image-size>Target &lt;500MB final image</image-size>
      </optimizations>
    </docker-configuration>
  </technical-specifications>

  <implementation-tasks>
    <task id="1" title="Setup Next.js App Router structure" ac="AC1,AC4">
      <subtask id="1.1">Create src/app/layout.tsx with Inter font and Manus theme</subtask>
      <subtask id="1.2">Create src/app/page.tsx as main chat page</subtask>
      <subtask id="1.3">Configure Next.js metadata for SEO</subtask>
      <subtask id="1.4">Test page loads without errors</subtask>
    </task>

    <task id="2" title="Configure Tailwind CSS with Manus theme" ac="AC2,AC3">
      <subtask id="2.1">Create tailwind.config.js with Manus color palette</subtask>
      <subtask id="2.2">Add Inter font family to Tailwind config</subtask>
      <subtask id="2.3">Install @tailwindcss/typography plugin</subtask>
      <subtask id="2.4">Create src/styles/globals.css with Manus CSS variables</subtask>
      <subtask id="2.5">Import globals.css in layout.tsx</subtask>
      <subtask id="2.6">Test all Manus colors render correctly</subtask>
    </task>

    <task id="3" title="Build core UI components" ac="AC1,AC4">
      <subtask id="3.1">Create src/components/Header.tsx (logo, navigation placeholder)</subtask>
      <subtask id="3.2">Create src/components/ChatInterface.tsx (main container)</subtask>
      <subtask id="3.3">Create src/components/MessageList.tsx (message display with placeholder)</subtask>
      <subtask id="3.4">Create src/components/InputBox.tsx (text input with send button)</subtask>
      <subtask id="3.5">Create TypeScript interfaces for all component props</subtask>
      <subtask id="3.6">Test all components render without errors</subtask>
    </task>

    <task id="4" title="Implement responsive design" ac="AC5">
      <subtask id="4.1">Add responsive Tailwind classes to all components</subtask>
      <subtask id="4.2">Test layout on desktop (&gt;1024px)</subtask>
      <subtask id="4.3">Test layout on tablet (768px-1024px)</subtask>
      <subtask id="4.4">Test layout on mobile (&lt;768px)</subtask>
      <subtask id="4.5">Verify touch targets are minimum 44x44px</subtask>
      <subtask id="4.6">Ensure no horizontal scrolling on any breakpoint</subtask>
    </task>

    <task id="5" title="Implement accessibility features" ac="AC6">
      <subtask id="5.1">Add semantic HTML structure (main, nav, section)</subtask>
      <subtask id="5.2">Implement keyboard navigation support</subtask>
      <subtask id="5.3">Add focus indicators for all interactive elements</subtask>
      <subtask id="5.4">Add ARIA labels where needed</subtask>
      <subtask id="5.5">Run Lighthouse accessibility audit (target &gt;90)</subtask>
      <subtask id="5.6">Verify WCAG AA contrast ratios</subtask>
    </task>

    <task id="6" title="Configure TypeScript and build tools" ac="AC1">
      <subtask id="6.1">Create/update tsconfig.json with strict mode</subtask>
      <subtask id="6.2">Configure path aliases (@/* for src/*)</subtask>
      <subtask id="6.3">Add missing dependencies to package.json</subtask>
      <subtask id="6.4">Run type-check to ensure no TypeScript errors</subtask>
      <subtask id="6.5">Configure ESLint for TypeScript and Tailwind</subtask>
    </task>

    <task id="7" title="Create Docker build configuration" ac="AC1">
      <subtask id="7.1">Create docker/Dockerfile.suna with multi-stage build</subtask>
      <subtask id="7.2">Update docker-compose.yaml with suna service configuration</subtask>
      <subtask id="7.3">Configure environment variables (NEXT_PUBLIC_API_BASE)</subtask>
      <subtask id="7.4">Test docker build completes successfully</subtask>
      <subtask id="7.5">Test docker container runs and serves app on :3000</subtask>
    </task>

    <task id="8" title="Testing and validation" ac="All">
      <subtask id="8.1">Create component unit tests</subtask>
      <subtask id="8.2">Create integration tests for page rendering</subtask>
      <subtask id="8.3">Create E2E tests with Playwright for critical paths</subtask>
      <subtask id="8.4">Test all acceptance criteria manually</subtask>
      <subtask id="8.5">Run Lighthouse performance and accessibility audits</subtask>
      <subtask id="8.6">Test browser compatibility (Chrome, Safari, Firefox)</subtask>
    </task>
  </implementation-tasks>

  <testing-strategy>
    <unit-tests>
      <test file="__tests__/components/ChatInterface.test.tsx">
        <description>Test ChatInterface renders without crashing</description>
        <description>Test empty state displays when no messages</description>
        <description>Test user input handling</description>
      </test>
      <test file="__tests__/components/Header.test.tsx">
        <description>Test Header renders logo and navigation</description>
      </test>
      <test file="__tests__/components/MessageList.test.tsx">
        <description>Test MessageList renders messages correctly</description>
        <description>Test auto-scroll behavior</description>
      </test>
      <test file="__tests__/components/InputBox.test.tsx">
        <description>Test InputBox handles user input</description>
        <description>Test Enter key sends message</description>
        <description>Test Shift+Enter creates new line</description>
      </test>
    </unit-tests>

    <integration-tests>
      <test file="__tests__/integration/chat-page.test.tsx">
        <description>Test complete chat page renders with all components</description>
        <description>Test Manus theme is applied correctly</description>
        <description>Test responsive layout on different screen sizes</description>
      </test>
    </integration-tests>

    <e2e-tests>
      <test file="__tests__/e2e/chat-ui.e2e.ts">
        <description>Test chat interface loads successfully</description>
        <description>Test Manus theme colors render correctly</description>
        <description>Test Inter font is loaded</description>
        <description>Test responsive design on multiple viewports</description>
        <description>Test accessibility with Lighthouse audit</description>
        <description>Test keyboard navigation works</description>
      </test>
    </e2e-tests>

    <manual-testing>
      <checklist>
        <item>Page loads in &lt;2s on localhost</item>
        <item>All Manus colors render correctly</item>
        <item>Inter font is applied everywhere</item>
        <item>Layout is centered and responsive</item>
        <item>Works on Chrome (latest)</item>
        <item>Works on Safari (latest)</item>
        <item>Works on Firefox (latest)</item>
        <item>Mobile view looks good on iPhone</item>
        <item>Mobile view looks good on Android</item>
        <item>Tablet view looks good on iPad</item>
        <item>Keyboard navigation works</item>
        <item>Focus indicators are visible</item>
        <item>No console errors</item>
        <item>No accessibility warnings</item>
        <item>Lighthouse score &gt;90 for accessibility</item>
      </checklist>
    </manual-testing>
  </testing-strategy>

  <validation-checklist>
    <development-environment>
      <item id="v1">npm install runs without errors</item>
      <item id="v2">npm run dev starts development server successfully</item>
      <item id="v3">No TypeScript compilation errors</item>
      <item id="v4">No ESLint warnings or errors</item>
      <item id="v5">Hot module replacement works correctly</item>
    </development-environment>
    <build-and-production>
      <item id="v6">npm run build completes successfully</item>
      <item id="v7">npm run start serves production build</item>
      <item id="v8">Docker image builds successfully</item>
      <item id="v9">Docker container runs without errors</item>
      <item id="v10">Environment variables are properly configured</item>
    </build-and-production>
    <visual-and-ux>
      <item id="v11">All Manus colors match specification</item>
      <item id="v12">Inter font loads and displays correctly</item>
      <item id="v13">Layout matches design requirements</item>
      <item id="v14">No layout shifts or visual glitches</item>
      <item id="v15">Responsive design works on all breakpoints</item>
      <item id="v16">Touch targets meet minimum size on mobile</item>
    </visual-and-ux>
    <accessibility>
      <item id="v17">Lighthouse accessibility score &gt;90</item>
      <item id="v18">WCAG AA contrast ratios verified</item>
      <item id="v19">Keyboard navigation functional</item>
      <item id="v20">Focus indicators visible</item>
      <item id="v21">Screen reader compatible</item>
    </accessibility>
    <performance>
      <item id="v22">Initial page load &lt;2s</item>
      <item id="v23">Time to Interactive &lt;3s</item>
      <item id="v24">Largest Contentful Paint &lt;2.5s</item>
      <item id="v25">Cumulative Layout Shift &lt;0.1</item>
      <item id="v26">First Input Delay &lt;100ms</item>
    </performance>
    <browser-testing>
      <item id="v27">Chrome: All features work</item>
      <item id="v28">Safari: All features work</item>
      <item id="v29">Firefox: All features work</item>
      <item id="v30">Mobile Chrome: All features work</item>
      <item id="v31">Mobile Safari: All features work</item>
    </browser-testing>
  </validation-checklist>

  <references>
    <reference type="prd" path="docs/PRD.md" sections="F1: Chat Interface, A1: Accessibility &amp; UX, P1: Performance Requirements"/>
    <reference type="architecture" path="docs/architecture.md" sections="Frontend Setup, Project Structure, Technology Stack Details, Implementation Patterns"/>
    <reference type="epic-tech-spec" path="docs/epics/epic-2-tech-spec.md" sections="Story 2.1: Suna UI Deployment with Manus Theme"/>
    <reference type="story" path=".bmad-ephemeral/stories/2-1-suna-ui-deployment-manus-theme.md"/>
    <reference type="docker-compose" path="docker-compose.yaml"/>
    <reference type="package-json" path="suna/package.json"/>
    <reference type="next-config" path="suna/next.config.js"/>
  </references>

  <dependencies>
    <prerequisite-stories>
      <story id="1-1" status="done">Project Setup &amp; Repository Initialization</story>
      <story id="1-2" status="done">Nginx Reverse Proxy Configuration</story>
      <story id="1-3" status="done">Environment Configuration &amp; Secrets Management</story>
    </prerequisite-stories>
    <blocked-stories>
      <story id="2-2">LiteLLM Proxy Setup &amp; Model Routing (needs UI to integrate with)</story>
      <story id="2-3">Message History &amp; Persistence (needs UI components)</story>
      <story id="2-4">Message Streaming &amp; Real-Time Response Display (needs ChatInterface)</story>
    </blocked-stories>
  </dependencies>

  <learnings-from-previous-stories>
    <learning story="1-1">
      <insight>Docker Compose foundation is solid - build on existing service definitions</insight>
      <insight>Environment variable pattern established - follow same pattern for NEXT_PUBLIC_* vars</insight>
    </learning>
    <learning story="1-2">
      <insight>Nginx configured to reverse proxy :3000 - ensure Suna serves on this port</insight>
      <insight>SSL/TLS certificates configured - test HTTPS access after deployment</insight>
    </learning>
    <learning story="1-3">
      <insight>Environment variables loaded from .env.local - use for Next.js public vars</insight>
      <insight>Structured logging pattern established - apply same pattern to frontend logging</insight>
    </learning>
    <potential-challenges>
      <challenge priority="medium">
        <description>Font loading performance - use Next.js Font Optimization</description>
        <mitigation>Preload Inter font in layout, use font-display: swap</mitigation>
      </challenge>
      <challenge priority="low">
        <description>Tailwind configuration complexity - keep custom theme organized</description>
        <mitigation>Use Tailwind's extend feature, document color usage</mitigation>
      </challenge>
      <challenge priority="low">
        <description>Responsive design edge cases - test on real devices</description>
        <mitigation>Use browser dev tools for various screen sizes, consider tablet landscape</mitigation>
      </challenge>
    </potential-challenges>
  </learnings-from-previous-stories>

  <dev-guidance>
    <approach>
      <step>1. Start with Next.js App Router structure (layout.tsx, page.tsx)</step>
      <step>2. Configure Manus theme in Tailwind (colors, fonts, global styles)</step>
      <step>3. Build component structure from outside-in (layout → page → components)</step>
      <step>4. Implement responsive design with mobile-first approach</step>
      <step>5. Add accessibility features (semantic HTML, ARIA labels, keyboard nav)</step>
      <step>6. Configure TypeScript strict mode and ensure type safety</step>
      <step>7. Create Docker build configuration and test deployment</step>
      <step>8. Write tests and validate all acceptance criteria</step>
    </approach>

    <key-considerations>
      <consideration>Use Next.js 14 App Router (not Pages Router) for server components and streaming</consideration>
      <consideration>Apply Manus theme consistently - all components should use Tailwind classes</consideration>
      <consideration>Ensure all interactive elements are keyboard accessible</consideration>
      <consideration>Test responsive design at all breakpoints (desktop, tablet, mobile)</consideration>
      <consideration>Use TypeScript strict mode for type safety</consideration>
      <consideration>Keep components simple and focused - complex logic will be added in later stories</consideration>
      <consideration>Optimize for performance - use Next.js automatic optimizations</consideration>
    </key-considerations>

    <success-criteria>
      <criteria>Chat interface loads in &lt;2s with no errors</criteria>
      <criteria>Manus dark theme applied consistently across all components</criteria>
      <criteria>Inter font loads and displays correctly</criteria>
      <criteria>Layout is responsive on desktop, tablet, and mobile</criteria>
      <criteria>Accessibility score &gt;90 on Lighthouse audit</criteria>
      <criteria>All acceptance criteria validated and passing</criteria>
      <criteria>Docker build succeeds and container runs on :3000</criteria>
      <criteria>TypeScript compiles with no errors in strict mode</criteria>
    </success-criteria>

    <implementation-notes>
      <note>Story 2.1 focuses on UI foundation - message streaming and backend integration come in later stories</note>
      <note>ChatInterface component will be expanded in Story 2.4 with streaming logic</note>
      <note>MessageList and InputBox are placeholders for now - full functionality in Story 2.3 and 2.4</note>
      <note>Use TypeScript interfaces for all component props to ensure type safety</note>
      <note>Follow Next.js 14 best practices for App Router and Server Components</note>
    </implementation-notes>
  </dev-guidance>

  <potential-risks>
    <risk probability="low" impact="medium">
      <description>Font loading delays causing layout shift</description>
      <mitigation>Use Next.js Font Optimization with font-display: swap</mitigation>
    </risk>
    <risk probability="low" impact="low">
      <description>Tailwind purge removing needed styles</description>
      <mitigation>Test production build, add safelist if needed</mitigation>
    </risk>
    <risk probability="medium" impact="low">
      <description>Responsive breakpoints not covering all devices</description>
      <mitigation>Test on real devices, use flexible breakpoints</mitigation>
    </risk>
  </potential-risks>
</story-context>
